sudo: required
language: generic
services:
  - docker
env:
  global:
  # Encrypted Coveralls token. The secret token for your repository can be found at the
  # bottom of your repository's page on Coveralls. To encrypt it, install the travis gem
  # and run:
  #     travis encrypt -r ubuntu-core/snappy COVERALLS_TOKEN=$secret_token
  - secure: JJEh1YfzNJGb1//ca447JtRunHmNXsVDGy5fS882/RQV3XtS9mCaSS+PZF4AbVABSiDw96mvwv05KmhdgV575y0NVHuRPd3rJBku9HOmhOKfCykn5tXgVJUEgeW5HIPusltRkXJUxnm48l+RfHHJU1h6iJnpGjvwxygeQljM4d22+G493ymvv4KZJSnbtuDbmhWvnZtdV2cCFeZ+EWqLgyWaFQmMgeMkYYcY3Cy19d++WquLs4woN9S9szrXJQlIv3xuZ8XNLbWmHoe6uD4y1Fn7YYfRgz861KqusxcGO9OyCh1S6uLgDuETS4Uw2zBg77vv59jSJieEfcY8jQtFE65axot/90jwhp5IV0tIpd9O/AMZXIGqKk44RU+Sj9gDbPbBIhj9dew3BTwSuOcNITSg1a4sOkxHGyIj2NozCkgFqPq0d4RM7xRrOYfnmjP1sJ+tEH4XMbs4gNZ/abccJXeUx6i5qWhDdnix132C62vvl+ItnsfMtkXQ34hluYxoab+rS0Zz3MM/ENqHySvU/R2n7+WTVXHyoK55HvExX7Y+McqPU2uVsHDabmDmQfcYom9nDY1OTBM3JbTOuqtIrzSIlFYdogyttXrTsmSue8TAoWWnHirKdkzeskIs5ZbI/pfGV3eRol+9Mn0MtmaoLp1VrAtSiZYwPRdcIGBDNMQ=
  matrix:
  - TEST_SUITE=unit
#  - TEST_SUITE=integration
#  - TEST_SUITE="examples --skip-install"

before_install:
  - docker pull ubuntu:xenial
install:
  - docker run -t -i -v $(pwd):/root ubuntu:xenial /bin/bash
  - ls /root
  - docker run ubuntu:xenial /bin/sh -c "apt-get update -qq; apt-get install -qq build-essential dpkg-dev pyflakes python3-apt python3-docopt python3-coverage python3-fixtures python3-jsonschema python3-mccabe python3-pip python3-pep8 python3-requests python3-testscenarios python3-testtools python3-yaml python3-lxml squashfs-tools"
script:
  - docker run ubuntu:xenial /bin/sh -c "cd /root/snapcraft; ./runtests.sh $TEST_SUITE"
after_success:
  - docker run ubuntu:xenial /bin/sh -c "pip install coveralls"
  - docker run ubuntu:xenial /bin/sh -c "cd /root/snapcraft; COVERALLS_REPO_TOKEN=$COVERALLS_TOKEN coveralls"
