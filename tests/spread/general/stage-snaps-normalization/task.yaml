summary: "Correct behavior for stage-snaps when used with the pc snap"

environment:
  STAGE_PACKAGES/none: ""
  STAGE_PACKAGES/hello: "hello"

prepare: |
  #shellcheck source=tests/spread/tools/snapcraft-yaml.sh
  . "$TOOLS_DIR/snapcraft-yaml.sh"

  snapcraft init
  set_base "snap/snapcraft.yaml"

  # get core number (like 22 or 24)
  base="$(get_base)"
  PC_TRACK="${base//[^0-9]/}"

  echo "    stage-snaps: [pc/${PC_TRACK}/stable]" >> snap/snapcraft.yaml

  if [ -n "${STAGE_PACKAGES}" ]; then
    echo "    stage-packages: [$STAGE_PACKAGES]" >> snap/snapcraft.yaml
  fi

restore: |
  snapcraft clean
  rm -rf snap

execute: |
  snapcraft build
