# SPDX-License-Identifier: GPL-2.0
# Copyright (C) 2021 Canonical Ltd
name: pc-kernel
summary: Kernel plugin test
description: A pc kernel to test the kernel plugin.

grade: stable
build-base: core20
confinement: strict
type: kernel
adopt-info: kernel

architectures:
  - build-on: amd64
    run-on: amd64

parts:
  kernel:
    plugin: kernel
    source: https://git.launchpad.net/~ubuntu-kernel/ubuntu/+source/linux/+git/focal
    source-depth: 1
    source-type: git
    source-branch: master
    stage-packages:
      - linux-firmware
      - wireless-regdb
    kernel-kconfigflavour: "generic"
    kernel-enable-zfs-support: true
    kernel-kconfigs:
      - CONFIG_DEBUG_INFO=n
    override-build: |
      snapcraftctl build

      snapcraftctl set-version $(git --git-dir=${SNAPCRAFT_PART_SRC}/.git describe --tags | cut -c 8-38)
