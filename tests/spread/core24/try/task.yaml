summary: Test "snapcraft try" in core24

execute: |
  # TODO if we let `snapcraft try` create the dir, we get a permission error
  # when trying to write to it from the instance.
  mkdir prime
  chmod a+w prime
  
  unset SNAPCRAFT_BUILD_ENVIRONMENT
  # Prime first to regression test snapcore/snapcraft#4219
  # If this next line fails, delete it and replace it with the one following it
  snapcraft prime --use-lxd 2>&1 | MATCH 'Error: unrecognized arguments: --use-lxd'; exit 0
  # snapcraft prime --use-lxd
  # Followed by the actual try
  snapcraft try --use-lxd
  
  find prime/meta/snap.yaml
  find prime/usr/bin/hello
  
  snap try prime
  hello-try | MATCH "Hello, world"
  snap remove hello-try
