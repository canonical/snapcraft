summary: Run snapcraft lint on a snap file with a valid assert file.

restore: |
  rm -f ./*.snap ./*.assert

execute: |
  # download a snap and assertion with a core24 base
  snap download --edge core24

  # give it a predictable name to simplify testing
  mv core24_*.snap core24.snap
  mv core24_*.assert core24.assert

  # test the linter using a build provider
  unset SNAPCRAFT_BUILD_ENVIRONMENT

  snapcraft lint core24.snap 2> output.txt

  # confirm there was not an assertion error
  if grep -q "Could not add assertions from file" output.txt; then
    exit 1
  fi
  # confirm linter executed
  grep "Running linters..." output.txt

  # make a bad assert file
  cp core24.snap core24.assert

  # snapcraft should handle the bad assert file and still run the linter
  snapcraft lint core24.snap 2> output.txt

  # confirm there was an assertion error
  grep "Could not add assertions from file" output.txt
  grep "Running linters..." output.txt
