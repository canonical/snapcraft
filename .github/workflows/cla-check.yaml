name: cla-check
on: [pull_request]

jobs:
  cla-check:
    runs-on: ubuntu-18.04
    steps:
      - name: Install dependencies
        run: |
          sudo apt-get update
          sudo apt-get install python3-launchpadlib git
      - name: Checkout code
        uses: actions/checkout@v2
        with:
          fetch-depth: 0
          # ensure we pull PR /head, not autogenerated /merge commit
          ref: ${{ github.event.pull_request.head.sha }}
      - name: Fetching base ref ${{ github.base_ref }}
        run: git fetch origin ${{ github.base_ref }}:${{ github.base_ref }}
      - name: Perform CLA check
        run: ./tools/cla_check.py "${{ github.base_ref }}..HEAD"
